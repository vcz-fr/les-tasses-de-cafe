var gdjs;(function(i){const s=new i.Logger("Font manager"),d=["font"];class l{constructor(t){this._loadedFontFamily=new i.ResourceCache;this._loadedFontFamilySet=new Set;this._resourceLoader=t}getResourceKinds(){return d}getFontFamily(t){return this._loadedFontFamily.getFromName(t)||"Arial"}getFontFile(t){const e=this._resourceLoader.getResource(t);return e?e.file||"":t}_getFontFamilyFromFilename(t){let e="gdjs_font_"+t.file.toLowerCase().replace(/[^\w]/gi,"-");const n=e;let o=2;for(;this._loadedFontFamilySet.has(e);)e=e+"-"+o,o++;return n}_loadFont(t,e){const n={},o="url("+encodeURI(e)+")";if(typeof FontFace!="undefined")return fetch(this._resourceLoader.getFullUrl(e),{credentials:this._resourceLoader.checkIfCredentialsRequired(e)?"include":"same-origin"}).then(r=>{if(!r.ok){const a="Unable to fetch "+e+" to be loaded as a font. HTTP status is: "+r.status+".";throw s.error(a),new Error(a)}return r.arrayBuffer()}).then(r=>{const a=new FontFace(t,r,n);document.fonts.add(a)});{const r=document.createElement("style");return r.appendChild(document.createTextNode("@font-face { font-family: '"+t+"'; src: "+o+"; }")),document.head.appendChild(r),new FontFaceObserver(t,n).load()}}async processResource(t){}async loadResource(t){const e=this._resourceLoader.getResource(t);if(!e){s.warn('Unable to find font for resource "'+t+'".');return}if(this._loadedFontFamily.get(e))return;const n=e.file;if(!n)return;const o=this._getFontFamilyFromFilename(e);this._loadedFontFamily.set(e,o),this._loadedFontFamilySet.add(o);try{await this._loadFont(o,n)}catch(r){s.error('Error loading font resource "'+e.name+'" (file: '+n+"): "+(r.message||"Unknown error"))}}dispose(){this._loadedFontFamily.clear(),this._loadedFontFamilySet.clear()}unloadResourcesList(t){t.forEach(e=>{this._loadedFontFamily.get(e)&&this._loadedFontFamily.delete(e);const o=this._getFontFamilyFromFilename(e);o&&this._loadedFontFamilySet.delete(o)})}}i.FontFaceObserverFontManager=l,i.FontManager=l})(gdjs||(gdjs={}));
//# sourceMappingURL=fontfaceobserver-font-manager.js.map
